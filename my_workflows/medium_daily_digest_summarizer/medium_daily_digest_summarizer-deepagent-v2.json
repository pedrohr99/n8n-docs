{
  "name": "medium_daily_digest_summarizer",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 10,
              "triggerAtMinute": 30
            }
          ]
        }
      },
      "id": "d2f77869-56e6-4706-9cd1-f832edadff09",
      "name": "Daily Schedule",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        0,
        0
      ]
    },
    {
      "parameters": {
        "operation": "getAll",
        "limit": 1,
        "filters": {
          "receivedAfter": "={{ $now.minus({ days: 1 }).toISO() }}"
        }
      },
      "id": "f74e3305-162d-4172-b80b-13cbb8733a18",
      "name": "Fetch Medium Digest",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        224,
        0
      ],
      "webhookId": "c8e364fe-e8b8-4065-b242-18839db62912",
      "credentials": {
        "gmailOAuth2": {
          "id": "viPkNlIYja6xb7WC",
          "name": "Gmail account pedroh.r99"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "email-exists-condition",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "rightType": "any"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "f3214775-2c7d-4e40-9660-b12f40c48a33",
      "name": "Check Email Exists",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        448,
        0
      ]
    },
    {
      "parameters": {
        "jsCode": "// Extract article links from Medium Daily Digest email HTML\nconst emailData = $input.all();\n\nif (!emailData || emailData.length === 0) {\n  return [];\n}\n\nconst results = [];\n\nfor (const email of emailData) {\n  const htmlContent = email.json.payload?.parts?.find(part => part.mimeType === 'text/html')?.body?.data;\n  \n  if (!htmlContent) {\n    console.log('No HTML content found in email');\n    continue;\n  }\n  \n  // Decode base64 HTML content\n  const decodedHtml = Buffer.from(htmlContent, 'base64').toString('utf-8');\n  \n  // Extract Medium article links using regex\n  // Look for links that contain medium.com and appear to be article URLs\n  const linkRegex = /https:\\/\\/[^\\s\"'<>]*medium\\.com\\/[^\\s\"'<>]*[a-f0-9]{12}/gi;\n  const matches = decodedHtml.match(linkRegex) || [];\n  \n  // Remove duplicates and filter valid article URLs\n  const uniqueLinks = [...new Set(matches)]\n    .filter(link => {\n      // Filter out non-article URLs (like profile pages, topic pages, etc.)\n      return !link.includes('/tag/') && \n             !link.includes('/topics/') && \n             !link.includes('/@') && \n             link.includes('-');\n    })\n    .slice(0, 10); // Limit to 10 articles to avoid rate limiting\n  \n  console.log(`Found ${uniqueLinks.length} unique Medium article links`);\n  \n  // Create separate items for each link\n  uniqueLinks.forEach((link, index) => {\n    results.push({\n      json: {\n        articleUrl: link,\n        emailId: email.json.id,\n        emailSubject: email.json.payload?.headers?.find(h => h.name === 'Subject')?.value || 'Medium Daily Digest',\n        emailDate: email.json.payload?.headers?.find(h => h.name === 'Date')?.value || new Date().toISOString(),\n        articleIndex: index + 1\n      }\n    });\n  });\n}\n\nreturn results;"
      },
      "id": "465b73c6-1706-48cc-9ea7-cb63da1f7b02",
      "name": "Extract Article Links",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        672,
        0
      ]
    },
    {
      "parameters": {
        "options": {
          "reset": false
        }
      },
      "id": "ee3d408a-a00e-4200-baa2-934b201f98d8",
      "name": "Process Articles One by One",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        880,
        0
      ]
    },
    {
      "parameters": {
        "url": "={{ $json.articleUrl }}",
        "options": {
          "redirect": {},
          "timeout": 30000
        }
      },
      "id": "20e34023-aa8e-4468-b1d0-a4e5187e55b6",
      "name": "Fetch Article Content",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1104,
        0
      ]
    },
    {
      "parameters": {},
      "id": "3a36bc56-dbd7-4184-ba94-1970af28efd4",
      "name": "Rate Limit Wait",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1328,
        0
      ],
      "webhookId": "04c64539-1b90-4567-8444-03162de22689"
    },
    {
      "parameters": {
        "jsCode": "// Extract article title and content, then create summary\nconst items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const html = item.json.data || '';\n  const articleUrl = item.json.articleUrl;\n  \n  if (!html) {\n    results.push({\n      json: {\n        ...item.json,\n        title: 'Unable to fetch article',\n        summary: 'Could not retrieve article content.',\n        error: 'No HTML content received'\n      }\n    });\n    continue;\n  }\n  \n  try {\n    // Extract title - try multiple selectors\n    let title = '';\n    const titleMatches = [\n      html.match(/<title[^>]*>([^<]+)<\\/title>/i),\n      html.match(/<h1[^>]*>([^<]+)<\\/h1>/i),\n      html.match(/<meta[^>]*property=[\"']og:title[\"'][^>]*content=[\"']([^\"']+)[\"']/i),\n      html.match(/<meta[^>]*name=[\"']title[\"'][^>]*content=[\"']([^\"']+)[\"']/i)\n    ];\n    \n    for (const match of titleMatches) {\n      if (match && match[1]) {\n        title = match[1].trim();\n        // Clean up title\n        title = title.replace(/\\s*\\|\\s*Medium$/, '').replace(/\\s*â€”\\s*Medium$/, '').trim();\n        break;\n      }\n    }\n    \n    if (!title) {\n      title = 'Medium Article';\n    }\n    \n    // Extract article content - look for common Medium selectors\n    let content = '';\n    const contentMatches = [\n      html.match(/<article[^>]*>([\\s\\S]*?)<\\/article>/i),\n      html.match(/<div[^>]*class=[\"'][^\"']*article[^\"']*[\"'][^>]*>([\\s\\S]*?)<\\/div>/i),\n      html.match(/<main[^>]*>([\\s\\S]*?)<\\/main>/i)\n    ];\n    \n    for (const match of contentMatches) {\n      if (match && match[1]) {\n        content = match[1];\n        break;\n      }\n    }\n    \n    if (!content) {\n      // Fallback: extract all paragraph content\n      const paragraphs = html.match(/<p[^>]*>([\\s\\S]*?)<\\/p>/gi) || [];\n      content = paragraphs.slice(0, 10).join(' '); // First 10 paragraphs\n    }\n    \n    // Clean HTML tags and extract text\n    const cleanText = content\n      .replace(/<script[\\s\\S]*?<\\/script>/gi, '')\n      .replace(/<style[\\s\\S]*?<\\/style>/gi, '')\n      .replace(/<[^>]+>/g, ' ')\n      .replace(/\\s+/g, ' ')\n      .trim();\n    \n    // Create summary (first 2-3 sentences or ~200 characters)\n    let summary = '';\n    if (cleanText) {\n      const sentences = cleanText.match(/[^.!?]+[.!?]+/g) || [];\n      if (sentences.length >= 2) {\n        summary = sentences.slice(0, 3).join(' ').trim();\n      } else {\n        summary = cleanText.substring(0, 200).trim();\n        if (summary.length === 200 && cleanText.length > 200) {\n          summary += '...';\n        }\n      }\n    }\n    \n    if (!summary) {\n      summary = 'Unable to extract article summary from content.';\n    }\n    \n    results.push({\n      json: {\n        ...item.json,\n        title: title,\n        summary: summary,\n        wordCount: cleanText.split(' ').length,\n        extractedAt: new Date().toISOString()\n      }\n    });\n    \n  } catch (error) {\n    console.error('Error processing article:', error);\n    results.push({\n      json: {\n        ...item.json,\n        title: 'Processing Error',\n        summary: 'An error occurred while processing this article.',\n        error: error.message\n      }\n    });\n  }\n}\n\nreturn results;"
      },
      "id": "5220558f-0784-469c-856e-fed8037c414f",
      "name": "Extract Title & Summarize",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1552,
        0
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "articles",
        "options": {}
      },
      "id": "aa5fd277-b1ed-4adb-a0e0-43af24942de4",
      "name": "Collect All Articles",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1760,
        0
      ]
    },
    {
      "parameters": {
        "jsCode": "// Generate markdown file with all articles\nconst items = $input.all();\n\nif (!items || items.length === 0) {\n  return [{\n    json: {\n      fileName: `medium_digest_${new Date().toISOString().split('T')[0]}.md`,\n      content: '# Medium Daily Digest\\n\\nNo articles found in today\\'s digest.',\n      articleCount: 0\n    }\n  }];\n}\n\nconst articles = items[0].json.articles || [];\nconst today = new Date();\nconst dateStr = today.toISOString().split('T')[0];\nconst formattedDate = today.toLocaleDateString('en-US', { \n  weekday: 'long', \n  year: 'numeric', \n  month: 'long', \n  day: 'numeric' \n});\n\n// Create markdown content\nlet markdown = `# Medium Daily Digest - ${formattedDate}\\n\\n`;\nmarkdown += `*Generated on ${today.toISOString()}*\\n\\n`;\nmarkdown += `Found ${articles.length} articles in today's digest:\\n\\n`;\nmarkdown += '---\\n\\n';\n\n// Add each article\narticles.forEach((article, index) => {\n  markdown += `## ${index + 1}. ${article.title}\\n\\n`;\n  markdown += `**Summary:** ${article.summary}\\n\\n`;\n  markdown += `**Link:** [Read on Medium](${article.articleUrl})\\n\\n`;\n  \n  if (article.wordCount) {\n    markdown += `*Estimated reading: ~${Math.ceil(article.wordCount / 200)} minutes*\\n\\n`;\n  }\n  \n  markdown += '---\\n\\n';\n});\n\n// Add footer\nmarkdown += `\\n*This digest was automatically generated by n8n workflow.*\\n`;\nmarkdown += `*Total articles processed: ${articles.length}*\\n`;\n\nconst fileName = `medium_digest_${dateStr}.md`;\n\nreturn [{\n  json: {\n    fileName: fileName,\n    content: markdown,\n    articleCount: articles.length,\n    generatedAt: today.toISOString(),\n    articles: articles\n  }\n}];"
      },
      "id": "9a3cda63-a33d-4ec0-bc03-01b2e52f5911",
      "name": "Create Markdown File",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1984,
        0
      ]
    },
    {
      "parameters": {
        "name": "={{ $json.fileName }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "mode": "list",
          "value": "root",
          "cachedResultName": "/ (Root folder)"
        },
        "options": {}
      },
      "id": "32d5038d-abf9-4161-9294-6843dc561c15",
      "name": "Upload to Google Drive",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2208,
        0
      ]
    },
    {
      "parameters": {},
      "id": "e46e4a6d-cccf-4bce-94a2-ed2a82c62dca",
      "name": "Success Notification",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        2432,
        0
      ]
    },
    {
      "parameters": {},
      "id": "7ff22734-777a-4009-b220-6dca1ec74600",
      "name": "No Email Found",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        448,
        208
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.error }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "error"
            }
          ]
        },
        "options": {}
      },
      "id": "b486a066-e41d-46d3-aa48-815b096ff5f8",
      "name": "Error Handler",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        2208,
        208
      ]
    },
    {
      "parameters": {},
      "id": "36bbd640-4b83-4263-8c20-895ce80f844d",
      "name": "Error Notification",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        2432,
        208
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Daily Schedule": {
      "main": [
        [
          {
            "node": "Fetch Medium Digest",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Medium Digest": {
      "main": [
        [
          {
            "node": "Check Email Exists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Email Exists": {
      "main": [
        [
          {
            "node": "Extract Article Links",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Email Found",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Article Links": {
      "main": [
        [
          {
            "node": "Process Articles One by One",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Articles One by One": {
      "main": [
        [
          {
            "node": "Fetch Article Content",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Collect All Articles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Article Content": {
      "main": [
        [
          {
            "node": "Rate Limit Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limit Wait": {
      "main": [
        [
          {
            "node": "Extract Title & Summarize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Title & Summarize": {
      "main": [
        [
          {
            "node": "Process Articles One by One",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Collect All Articles": {
      "main": [
        [
          {
            "node": "Create Markdown File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Markdown File": {
      "main": [
        [
          {
            "node": "Upload to Google Drive",
            "type": "main",
            "index": 0
          },
          {
            "node": "Error Handler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload to Google Drive": {
      "main": [
        [
          {
            "node": "Success Notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Handler": {
      "main": [
        [
          {
            "node": "Error Notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "5e8e40ab-9881-4fed-bc58-f41dff4d0c56",
  "meta": {
    "instanceId": "a396a459e20e70dadf88b2d8f204762d2d80680fe1414733547fa53f595d718e"
  },
  "id": "esswZCIYhnb05I1S",
  "tags": [
    {
      "name": "Medium Automation",
      "id": "HMsT9ybSy7vtmctn",
      "createdAt": "2025-08-28T14:38:43.090Z",
      "updatedAt": "2025-08-28T14:38:43.090Z"
    }
  ]
}